<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Confissão de Dívida</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            align-items: flex-start;
            gap: 30px;
            padding: 20px;
            flex-wrap: wrap; /* Permite que o preview quebre para baixo */
            justify-content: center; /* Centraliza o conteúdo */
        }

        /* Coluna do Formulário */
        #form-container {
            flex: 0 0 450px;
            background: #ffffff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 20px;
            max-height: 95vh;
            overflow-y: auto;
        }

        #form-container h1 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 25px;
            font-size: 1.5rem;
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9rem;
            color: #555;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group input[type="date"],
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        #gerar-pdf {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #gerar-pdf:hover:not(:disabled) {
            background-color: #0056b3;
        }

        #gerar-pdf:disabled {
            background-color: #aaa;
            cursor: not-allowed;
        }

        /* Coluna do Preview (container das páginas) */
        #preview-container {
            flex: 1; /* Permite crescer */
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 210mm; /* Garante largura mínima */
            align-items: center; /* Centraliza as páginas se houver espaço */
        }

        /* Estilo comum para as páginas A4 */
        .pagina-a4 {
            width: 210mm;
            height: 297mm; /* Altura A4 fixa */
            background: #ffffff;
            /* === AJUSTE DE MARGEM (TÍTULO PARA CIMA) === */
            /* Topo reduzido de 20mm para 15mm */
            padding: 15mm 25mm 30mm 25mm; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
            font-family: 'Times New Roman', Times, serif;
            color: #000;
            font-size: 10pt; 
            line-height: 1.5;
            overflow: hidden; /* Mantém o corte se o conteúdo exceder */
        }
        .pagina-a4 h3 {
            text-align: center;
            font-weight: bold;
            font-size: 12pt;
            margin-bottom: 25px;
        }

        .pagina-a4 p {
            text-align: justify; 
            margin-bottom: 15px; /* Margem original */
            text-indent: 50px;
        }

        .pagina-a4 .clausula {
            font-weight: bold;
            text-transform: uppercase;
            margin-top: 20px;
            margin-bottom: 10px;
            text-indent: 0;
        }

        .pagina-a4 .paragrafo {
            margin-left: 25px;
            text-indent: 0;
            text-align: justify;
            margin-bottom: 15px; /* Margem original */
        }

        .pagina-a4 .assinatura {
            text-align: center;
            margin-top: 40px; /* Margem original */
            text-indent: 0;
        }

        .pagina-a4 .data-local {
            text-align: center;
            margin-top: 40px;
            text-indent: 0;
        }

        /* Classe para destacar dados no *preview* */
        .variavel {
            font-weight: bold;
            color: #0d47a1;
            transition: color 0.3s ease;
        }

        /* Classe temporária para *remover* a cor durante a geração do PDF */
        .generating-pdf .variavel {
            color: #000;
            font-weight: normal;
        }
    </style>
</head>
<body>

    <div id="form-container">
        <h1>Gerar Confissão de Dívida</h1>

        <div class="form-group">
            <label for="nome">Nome Completo:</label>
            <input type="text" id="nome" placeholder="FULANO DE TAL">
        </div>

        <div class="form-group">
            <label for="rg">RG (com emissor):</label>
            <input type="text" id="rg" placeholder="N°RG SSP-ESTADO">
        </div>

        <div class="form-group">
            <label for="cpf">CPF:</label>
            <input type="text" id="cpf" placeholder="xxx.xxx.xxx-xx">
        </div>

        <div class="form-group">
            <label for="endereco">Endereço Completo:</label>
            <input type="text" id="endereco" placeholder="Quadra ... CEP: 71.xxx-xxx – Brasília/DF">
        </div>

        <div class="form-group">
            <label for="orgao">Órgão Vinculado:</label>
            <input type="text" id="orgao" placeholder="Polícia Militar do Distrito Federal">
        </div>

        <div class="form-group">
            <label for="margem-utilizada">Houve utilização de margem consignável?</label>
            <select id="margem-utilizada">
                <option value="Não">Não</option>
                <option value="Sim">Sim</option>
            </select>
        </div>

        <div class="form-group">
            <label for="valor-margem">Valor da Margem (se sim):</label>
            <input type="text" id="valor-margem" placeholder="R$ 0,00" class="campo-moeda">
        </div>

        <div class="form-group">
            <label for="banco-quitado">Banco a ser quitado:</label>
            <input type="text" id="banco-quitado" placeholder="Nome do Banco">
        </div>

        <div class="form-group">
            <label for="valor-parcelas-quitadas">Valor Parcelas (a quitar):</label>
            <input type="text" id="valor-parcelas-quitadas" placeholder="R$ 0,00" class="campo-moeda">
        </div>

        <div class="form-group">
            <label for="valor-parcelas-unificadas">Valor final das parcelas unificadas:</label>
            <input type="text" id="valor-parcelas-unificadas" placeholder="R$ 0,00" class="campo-moeda">
        </div>

        <div class="form-group">
            <label for="prazo">Prazo (em vezes):</label>
            <input type="text" id="prazo" placeholder="96 vezes">
        </div>

        <div class="form-group">
            <label for="saldo-devedor">Saldo Devedor Total:</label>
            <input type="text" id="saldo-devedor" placeholder="R$ 0,00" class="campo-moeda">
        </div>
        
        <div class="form-group">
            <label for="saldo-devedor-quitado">Saldo Devedor a ser Quitado:</label>
            <input type="text" id="saldo-devedor-quitado" placeholder="R$ 0,00" class="campo-moeda">
        </div>
        
        <div class="form-group">
            <label for="valor-total-nova-instituicao">Valor Total Aprox. na Nova Instituição:</label>
            <input type="text" id="valor-total-nova-instituicao" placeholder="R$ 0,00" class="campo-moeda">
        </div>
        <div class="form-group">
            <label for="valor-liquido">Valor líquido a ser recebido:</label>
            <input type="text" id="valor-liquido" placeholder="R$ 0,00" class="campo-moeda">
        </div>

        <div class="form-group">
            <label for="valor-repassado">Valor total a ser repassado à empresa:</label>
            <input type="text" id="valor-repassado" placeholder="R$ 0,00" class="campo-moeda">
        </div>

        <div class="form-group">
            <label for="local-data">Local e Data:</label>
            <input type="text" id="local-data" value="">
        </div>

        <button id="gerar-pdf">Gerar PDF</button>
    </div>

    <div id="preview-container">

        <div id="documento-pagina-1" class="pagina-a4">
            <h3>TERMO DE CIÊNCIA, DE RESPONSABILIDADE E CONFISSÃO DE DÍVIDA</h3>

            <p>
                Eu, <span id="doc-nome" class="variavel">[Nome]</span>, portador da cédula de identidade R.G.
                nº <span id="doc-rg" class="variavel">[RG]</span>, brasileiro, inscrito no CPF nº <span id="doc-cpf" class="variavel">[CPF]</span>, residente e domiciliado na <span id="doc-endereco" class="variavel">[Endereço]</span>, vinculado ao órgão <span id="doc-orgao" class="variavel">[Órgão]</span>.
            </p>

            <p>
                DECLARO, para os devidos fins, que autorizo a empresa POLLO PROMOTORA LTDA, inscrita no CNPJ sob o nº 44.906.703/0001-59, com sede na CSE 06, Lote 30, Sala 204 – Taguatinga Sul – CEP: 72025-065 – Brasília/DF, a realizar a quitação dos contratos consignados em meu contracheque, conforme descrito abaixo: A realizar a quitação do(s) contrato(s) de minha responsabilidade que estão consignados em meu holerite de pagamento conforme descrição abaixo:
            </p>

            <p class="clausula">CLÁUSULA PRIMEIRA – DA OPERAÇÃO</p>
            <p class="paragrafo">
                1.1. Houve utilização de margem consignável? ( <span id="doc-margem-utilizada" class="variavel">[Sim/Não]</span> ) Se sim, qual o valor? <span id="doc-valor-margem" class="variavel">[Valor Margem]</span>
            </p>
            <p class="paragrafo">
                Banco a ser quitado: <span id="doc-banco-quitado" class="variavel">[Banco a ser quitado]</span>
            </p>
            <p class="paragrafo">
                Parcelas: <span id="doc-valor-parcelas-quitadas" class="variavel">[Valor Parcelas Quitadas]</span>
            </p>
            <p class="paragrafo">
                Valor final das parcelas unificadas: <span id="doc-valor-parcelas-unificadas" class="variavel">[Valor Parcelas Unificadas]</span>
            </p>
            <p class="paragrafo">
                Prazo: <span id="doc-prazo" class="variavel">[Prazo]</span>
            </p>
            <p class="paragrafo">
                Saldo Devedor Total: <span id="doc-saldo-devedor" class="variavel">[Saldo Devedor]</span>
            </p>
            
            <p class="paragrafo">
                Saldo Devedor a ser Quitado: <span id="doc-saldo-devedor-quitado" class="variavel">[Saldo Devedor Quitado]</span>
            </p>
            <p class="paragrafo">
                Valor Total Aprox. Nova Instituição: <span id="doc-valor-total-nova-instituicao" class="variavel">[Valor Total Nova Instituição]</span>
            </p>
            <p class="clausula">CLÁUSULA SEGUNDA – DO PAGAMENTO</p>
            <p class="paragrafo">
                2.1. Valor líquido a ser recebido pelo cliente: <span id="doc-valor-liquido" class="variavel">[Valor Líquido]</span>, acrescido do estorno da parcela.
            </p>
            <p class="paragrafo">
                2.2. Valor total a ser repassado à empresa, referente à quitação do saldo devedor, comissão, impostos, seguro e juros: <span id="doc-valor-repassado" class="variavel">[Valor Repassado]</span>.
            </p>
            <p class="paragrafo">
                Parágrafo Único: Autorizo, desde já, que a empresa POLLO CONSIG atue como minha representante para digitação e pagamento das parcelas mencionadas, relativas à compra de dívida perante os bancos citados, com a transferência para o banco Bradesco S.A, observando que os valores podem variar de acordo com os juros e coeficientes do dia, mediante aprovação da operação.
            </p>
            
            <p class="clausula">CLÁUSULA TERCEIRA – DA ABERTURA DE CONTAS</p>
            <p class="paragrafo">
                3.1 . Caixa Econômica Federal : A abertura de conta será realizada para fins de averbação da margem consignável, conforme liberação das parcelas pelos bancos. Esta conta será utilizada também para TED dos valores, garantindo segurança para a empresa intermediadora e para o cliente. O cliente deverá, ainda, assinar e reconhecer firma do documento da TED, que será emitido com os valores das transferências.
            </p>
            <p class="paragrafo">
                3.2. Bradesco S.A : A abertura de conta será exigida para aprovação e pagamento do contrato. O banco solicita a abertura para que todos os aceites sejam realizados via aplicativo.
            </p>
            <p class="paragrafo">
                Parágrafo Único: Tenho ciência de que o banco pode levar de 7 (sete) a 10 (dez) dias para liberar a margem para averbação da proposta. Passado esse prazo, será feita cobrança ao banco. Autorizo o uso da minha senha do SOU GOV e do e-mail, exclusivamente para fins de consulta da margem consignável e eventuais autorizações, com a minha ciência.
            </p>
            
        </div>

        <div id="documento-pagina-2" class="pagina-a4">
        
            <p class="paragrafo" style="text-indent: 0; margin-left: 0; margin-top: 0;"> Ciente das informações acima e do disposto no parágrafo único, no qual preciso fornecer a senha do SOU GOV e email, assino abaixo:
            </p>

            <p class="assinatura" style="margin-top: 60px;">
                ASSINATURA DO DEVEDOR: _________________________________________
            </p>


            <p class="clausula">CLÁUSULA QUARTA – DAS CONDIÇÕES DA OPERAÇÃO</p>
            <p class="paragrafo">
                4.1 . Declaro estar ciente de que, uma vez assinada esta transação, será realizada a quitação dos contratos indicados, não sendo possível o cancelamento ou desistência da operation junto à nova instituição financeira até sua completa finalização.
            </p>

            <p class="clausula">CLÁUSULA QUINTA – DAS TESTEMUNHAS</p>
            <p class="paragrafo">
                5.1. Para contratos de clientes com idade superior a 60 (sessenta) anos, conforme a Lei nº 14.423, de 22 de julho de 2022, será exigida a assinatura de uma testemunha de primeiro grau com vínculo familiar com o cliente.
            </p>
            <p class="paragrafo">
                5.2. Na ausência de parente próximo ou caso o cliente opte por não contar com testemunha, será necessário o envio de um vídeo, no qual o cliente declare plena ciência do contrato e manifeste sua decisão de não ter testemunha. Esse vídeo deverá ser anexado à documentação da operação para fins de formalização.
            </p>
            <p class="paragrafo">
                Parágrafo Único: Comprometo-me a não utilizar a margem consignável correspondente ao contrato quitado em outra consignatária, devendo a mesma permanecer disponível até a conclusão da operação e contratação do novo contrato, intermediado pela Aliança Consig de Seguros Ltda., na instituição financeira que oferecer a melhor condição disponível no dia ou conforme indicação da empresa, respeitando meu perfil de crédito. Essa conduta visa manter a boa-fé na negociação, conforme a legislação vigente.
            </p>

            <p class="clausula">CLÁUSULA SEXTA – DA RESPONSABILIDADE CIVIL E PENAL</p>
            <p class="paragrafo">
                6.1. Declaro ter pleno conhecimento do conteúdo deste instrumento. Em caso de uso indevido da margem liberada junto a outra instituição financeira, estarei sujeito à responsabilização por eventual crime, que poderá ser comunicado às autoridades competentes.
            </p>

            <p class="assinatura" style="margin-top: 60px;">ASSINATURA DO CREDOR: _________________________________________</p>
            <p class="assinatura">ASSINATURA DO DEVEDOR: _______________________________________</p>

            <p class="assinatura">
                TESTEMUNHA (Grau de Parentesco): __________________________
            </p>

            <p class="assinatura" style="margin-top: 20px;">POLLO PROMOTORA LTDA</p>

            <p class="data-local" style="margin-top: 20px;">
                <span id="doc-local-data" class="variavel">[Local e Data]</span>
            </p>
        </div>

    </div>

    <script>
        // Importa o jsPDF
        const { jsPDF } = window.jspdf;

        // Função utilitária para formatar moeda
        const formatarMoeda = (v) => { 
            if (typeof v === 'string') {
                if (v.startsWith('R$')) return v; // Já está formatado
                v = moedaParaFloat(v); 
            }
            // Retorna 'R$ 0,00' se v for NaN ou 0, senão formata
            return (v || 0).toLocaleString("pt-BR", { style: "currency", currency: "BRL" }); 
        };
        // Função utilitária para converter string de moeda para float
        const moedaParaFloat = (v) => { 
            return parseFloat(String(v || '').replace('R$', '').trim().replace(/\./g, "").replace(",", ".")) || 0; 
        };

        // Função para atualizar a pré-visualização em tempo real
        function atualizarPreview() {
            const campos = {
                'nome': ['doc-nome'], 
                'rg': ['doc-rg'],
                'cpf': ['doc-cpf'],
                'endereco': ['doc-endereco'],
                'orgao': ['doc-orgao'],
                'margem-utilizada': ['doc-margem-utilizada'],
                'valor-margem': ['doc-valor-margem'],
                'banco-quitado': ['doc-banco-quitado'],
                'valor-parcelas-quitadas': ['doc-valor-parcelas-quitadas'],
                'valor-parcelas-unificadas': ['doc-valor-parcelas-unificadas'],
                'prazo': ['doc-prazo'],
                'saldo-devedor': ['doc-saldo-devedor'], 
                'valor-liquido': ['doc-valor-liquido'],
                'valor-repassado': ['doc-valor-repassado'],
                'local-data': ['doc-local-data'],
                'saldo-devedor-quitado': ['doc-saldo-devedor-quitado'],
                'valor-total-nova-instituicao': ['doc-valor-total-nova-instituicao']
            };

             // Lista de IDs de campos que devem ser formatados como moeda
            const camposMoeda = [
                'valor-margem', 'valor-parcelas-quitadas', 'valor-parcelas-unificadas', 
                'saldo-devedor', 'valor-liquido', 'valor-repassado',
                'saldo-devedor-quitado', 'valor-total-nova-instituicao' 
            ];

            for (const formId in campos) {
                const inputElement = document.getElementById(formId);
                if (!inputElement) continue; 

                const valor = inputElement.value;
                const docIds = campos[formId]; 

                docIds.forEach(docId => {
                    const el = document.getElementById(docId);
                    if (!el) return; 

                    let valorFinal = valor;

                    // Formata se for campo de moeda e não estiver vazio
                    if (camposMoeda.includes(formId) && valor.trim() !== "") {
                        const valorNumerico = moedaParaFloat(valor);
                        valorFinal = formatarMoeda(valorNumerico);
                    }

                    // Se estiver vazio, usa o placeholder do input ou um padrão
                    if (valor.trim() === "") {
                        let placeholderText = inputElement.placeholder || '';
                        
                        if (placeholderText === 'R$ 0,00') {
                             valorFinal = 'R$ 0,00';
                        } else if (!placeholderText.startsWith('R$')) {
                             valorFinal = el.getAttribute('data-placeholder') || el.textContent; 
                             if (!el.getAttribute('data-placeholder')) { // Salva apenas uma vez
                                el.setAttribute('data-placeholder', valorFinal); 
                             }
                        } else {
                            valorFinal = placeholderText;
                        }
                    }
                    el.textContent = valorFinal;
                });
            }
        }

        // Adiciona 'listeners' para atualizar o preview
        document.querySelectorAll('#form-container input, #form-container select').forEach(input => {
            input.addEventListener('input', atualizarPreview);
            
             // Adiciona listener de 'blur' para formatar campos de moeda ao sair do campo
            if (input.classList.contains('campo-moeda')) {
                input.addEventListener('blur', function() {
                    if (this.value.trim() !== "") {
                        const valorNumerico = moedaParaFloat(this.value);
                        this.value = formatarMoeda(valorNumerico); // Formata o próprio input
                        atualizarPreview(); // Atualiza o preview com o valor formatado
                    }
                });
            }
        });

        // Função para definir a data atual
        function setarDataAtual() {
            const meses = ["janeiro", "fevereiro", "março", "abril", "maio", "junho", "julho", "agosto", "setembro", "outubro", "novembro", "dezembro"];
            const hoje = new Date();
            const dia = hoje.getDate();
            const mesNome = meses[hoje.getMonth()];
            const ano = hoje.getFullYear();
            const dataFormatada = `Brasília/DF, ${dia} de ${mesNome} de ${ano}`;
            const campoData = document.getElementById('local-data');
            if (campoData.value === "") { // Só preenche se estiver vazio
                 campoData.value = dataFormatada;
            }
        }

        // Define a data atual no campo ao carregar a página
        setarDataAtual();

        // Chama a função no início para carregar os valores (placeholders) e a data
        atualizarPreview();

        // Lógica para gerar o PDF
        document.getElementById('gerar-pdf').addEventListener('click', async function () {

            const botao = this;
            botao.textContent = 'Gerando PDF...';
            botao.disabled = true;

            const nomeInput = document.getElementById('nome');
            const nomePessoa = nomeInput.value || nomeInput.placeholder || 'documento';
            const filename = `${nomePessoa.trim().replace(/\s+/g, '_')}_confissao_de_divida.pdf`;

            const doc1 = document.getElementById('documento-pagina-1');
            const doc2 = document.getElementById('documento-pagina-2');

            doc1.classList.add('generating-pdf');
            doc2.classList.add('generating-pdf');

            const pdf = new jsPDF('p', 'mm', 'a4');
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = pdf.internal.pageSize.getHeight();
            const options = {
                scale: 2,
                useCORS: true,
                logging: false,
                 windowWidth: doc1.scrollWidth, // Ajuda na renderização correta da largura
                 windowHeight: doc1.scrollHeight
            };

            try {
                // Processa a PÁGINA 1
                const canvas1 = await html2canvas(doc1, options);
                const imgData1 = canvas1.toDataURL('image/png', 0.95); // Usar PNG para melhor qualidade
                pdf.addImage(imgData1, 'PNG', 0, 0, pdfWidth, pdfHeight);

                // Adiciona uma nova página e processa a PÁGINA 2
                pdf.addPage();
                const canvas2 = await html2canvas(doc2, options);
                const imgData2 = canvas2.toDataURL('image/png', 0.95);
                pdf.addImage(imgData2, 'PNG', 0, 0, pdfWidth, pdfHeight);

                pdf.save(filename);
                // showToast("PDF gerado com sucesso!", "success"); // Feedback de sucesso (descomente se tiver a função)

            } catch (error) {
                console.error("Erro ao gerar PDF:", error);
                 // showToast("Ocorreu um erro ao gerar o PDF.", "danger"); // Feedback de erro (descomente se tiver a função)
            } finally {
                doc1.classList.remove('generating-pdf');
                doc2.classList.remove('generating-pdf');

                botao.textContent = 'Gerar PDF';
                botao.disabled = false;
            }
        });
    </script>

</body>
</html>